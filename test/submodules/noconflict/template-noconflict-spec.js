var pre = "@craydent/";
delete global.$c;
try { require.cache[require.resolve('../../../common.js')] && delete require.cache[require.resolve('../../../common.js')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-array')] && delete require.cache[require.resolve(pre + 'craydent-array')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-class')] && delete require.cache[require.resolve(pre + 'craydent-class')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-cli')] && delete require.cache[require.resolve(pre + 'craydent-cli')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-control-flow')] && delete require.cache[require.resolve(pre + 'craydent-control-flow')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-date')] && delete require.cache[require.resolve(pre + 'craydent-date')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-fs')] && delete require.cache[require.resolve(pre + 'craydent-fs')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-function')] && delete require.cache[require.resolve(pre + 'craydent-function')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-http')] && delete require.cache[require.resolve(pre + 'craydent-http')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-json-parser')] && delete require.cache[require.resolve(pre + 'craydent-json-parser')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-number')] && delete require.cache[require.resolve(pre + 'craydent-number')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-object')] && delete require.cache[require.resolve(pre + 'craydent-object')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-regexp')] && delete require.cache[require.resolve(pre + 'craydent-regexp')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-string')] && delete require.cache[require.resolve(pre + 'craydent-string')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-template')] && delete require.cache[require.resolve(pre + 'craydent-template')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-typeof')] && delete require.cache[require.resolve(pre + 'craydent-typeof')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-utility')] && delete require.cache[require.resolve(pre + 'craydent-utility')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-xml-to-json')] && delete require.cache[require.resolve(pre + 'craydent-xml-to-json')]; }catch(e){}

try { require.cache[require.resolve(pre + 'craydent-array/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-array/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-class/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-class/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-cli/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-cli/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-control-flow/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-control-flow/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-date/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-date/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-fs/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-fs/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-function/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-function/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-http/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-http/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-json-parser/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-json-parser/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-number/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-number/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-object/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-object/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-regexp/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-regexp/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-string/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-string/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-template/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-template/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-typeof/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-typeof/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-utility/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-utility/noConflict')]; }catch(e){}
try { require.cache[require.resolve(pre + 'craydent-xml-to-json/noConflict')] && delete require.cache[require.resolve(pre + 'craydent-xml-to-json/noConflict')]; }catch(e){}


try { require.cache[require.resolve('../../../noConflict.js')] && delete require.cache[require.resolve('../../../noConflict.js')]; }catch(e){}
try { require.cache[require.resolve('../../../global.js')] && delete require.cache[require.resolve('../../../global.js')]; }catch(e){}
try { require.cache[require.resolve('../../../craydent.js')] && delete require.cache[require.resolve('../../../craydent.js')]; }catch(e){}


require.cache[require.resolve(pre + 'craydent-template/noConflict.js')] && delete require.cache[require.resolve(pre + 'craydent-template/noConflict.js')];
var $c = require(pre + 'craydent-template/noConflict.js');
$c.DEBUG_MODE = true;
describe ('No Conflict Global methods', function () {
	beforeEach(function() {
		this.addMatchers({
			toMatchPropAndConstructor: function (expected) {
				if (expected === undefined) {
					expected = {};
				}
				for (var prop in this.actual) {
					if (!this.actual.hasOwnProperty(prop)) { continue; }
					if (expected[prop] == undefined || expected[prop].constructor != this.actual[prop].constructor) {
						return false;
					}
				}
				return true;
			}
		});
	});
	it('fillTemplate',function(){
		var obj = [{arr:[{hi:"b"},{hi:"c"}],name:"operation"},{arr:[{hi:"b"},{hi:"c"}],name:"operation"}],
				obj2 = {arr:['monday','tuesday']},
				obj3 = {a:'monday',b:'tuesday'},
				obj4 = {a:'monday',b:'tuesday',hello:'world'},
				obj5 = {a:'monday',b:'tuesday',hello:'bite'},
				simple = {hello:"world"},
				simple2 = {a:{hello:"world"}};
		$c.TEMPLATE_VARS.push({variable:"TNAME",value:"this template var"});
		expect($c.fillTemplate("<div>${name}<div>${foreach ${item} in ${arr}}${item.hi}8888${name}9999${end foreach}</div></div>",obj))
				.toBe("<div>operation<div>b8888operation9999c8888operation9999</div></div><div>operation<div>b8888operation9999c8888operation9999</div></div>")
		expect($c.fillTemplate("<div>${TNAME}<div>")).toBe("<div>this template var<div>");
		expect($c.fillTemplate("<div ${dataproperties}>${hello}<div>",simple)).toBe("<div data-hello='world' >world<div>");
		expect($c.fillTemplate("<div>${this.a.hello}${index}<div>",simple2)).toBe("<div>world0<div>");
		expect($c.fillTemplate("<div>${this.a.hello}${index}<div>",simple2)).toBe("<div>world0<div>");
		expect($c.fillTemplate("<div>${a.hello}${index}<div>",simple2)).toBe("<div>world0<div>");
		expect($c.fillTemplate("<div>${COUNT[${arr}]}<div>",obj)).toBe("<div>2<div><div>2<div>");
		expect($c.fillTemplate("<div>${ENUM[${arr};]}<div>",obj2)).toBe("<div>monday, tuesday<div>");
		expect($c.fillTemplate("<div>${ENUM[${this};\"?\";[\"{ENUM_VAL}-\",\"-{ENUM_VAR}\"]]}<div>",obj3)).toBe("<div>monday-a-a?tuesday-b-b<div>");
		expect($c.fillTemplate("<div>${${novar}||${hello}}<div>",simple)).toBe("<div>world<div>");
		expect($c.fillTemplate("<div>${${hello}||${novar}}<div>",simple)).toBe("<div>world<div>");
		expect($c.fillTemplate("<div>${${novar}&&${hello}}<div>",simple)).toBe("<div><div>");
		expect($c.fillTemplate("<div>${${hello}&&'hello'}<div>",simple)).toBe("<div>hello<div>");
		expect($c.fillTemplate("<div>${function add (a,b) { return a+b; }|1|2}<div>",simple)).toBe("<div>3<div>");
		$g.tempFunc = function (o) { return o.a + " & " + o.b; }
		expect($c.fillTemplate("<div>${RUN[tempFunc;${this}]}<div>",obj3)).toBe("<div>monday & tuesday<div>");
		expect($c.fillTemplate("<div>${if (${hi})}<span>${hi}</span>${elseif (${bye})}<p>${bye}</p>${else}<a>${a}</a>${end if}</div>",obj3)).toBe("<div><a>monday</a></div>");
		expect($c.fillTemplate("<div>${if (${hi})}<span>${hi}</span>${elseif (${bye})}<p>${bye}</p>${else}<a>${a}</a>${end if}</div>",{hi:"hello"})).toBe("<div><span>hello</span></div>");
		expect($c.fillTemplate("<div>${if (${hi})}<span>${hi}</span>${elseif (${bye})}<p>${bye}</p>${else}<a>${a}</a>${end if}</div>",{bye:"bbye"})).toBe("<div><p>bbye</p></div>");
		expect($c.fillTemplate("<div>${if (${this.bye.value})}<span>${hi}</span>${elseif (${bye})}<p>${bye}</p>${else}<a>${a}</a>${end if}</div>",{hi:"hello",bye:{value:"bbye"}})).toBe("<div><span>hello</span></div>");
		expect($c.fillTemplate("<div>${if (${hi})}<span>${hi}</span>${elseif (${this.bye.value})}<p>${this.bye.value}</p>${end if}</div>",{bye:{value:"bbye"}})).toBe("<div><p>bbye</p></div>");
		expect($c.fillTemplate("<div>${if (${this.bye.value})}<span>${this.bye.value}</span>${elseif (${bye})}<p>${bye}</p>${end if}</div>",{bye:{value:"bbye"}})).toBe("<div><span>bbye</span></div>");
		expect($c.fillTemplate("<div>${if (${hi})}<span>${hi}</span>${elseif (${this.bye.value})}<p>${this.bye.value}</p>${end if}</div>",{bye:{value:"bbye"}})).toBe("<div><p>bbye</p></div>");
		expect($c.fillTemplate("divhere${if (${this.User.length} || ${this.User})}div${end if}ending",{User:['']})).toBe("divheredivending");
		expect($c.fillTemplate("divhere${if (${this.User.length} || ${this.User})}div${end if}ending",{User:[]})).toBe("divheredivending");
		expect($c.fillTemplate("divhere${if (${this.User})}div${end if}ending",{User:[]})).toBe("divheredivending");
		expect($c.fillTemplate("divhere${if (${this.User.length})}div${end if}ending",{User:[]})).toBe("divhereending");
		expect($c.fillTemplate("divhere${if ('${this.User}')}div${end if}ending",{User:"adsf"})).toBe("divheredivending");
		expect($c.fillTemplate("<div>${name}<div>${for ${i=0,len=${arr}.length};${i<len};${i++}}${${arr}[i].hi}8888${name}9999${end for}</div></div>",obj))
				.toBe("<div>operation<div>b8888operation9999c8888operation9999</div></div><div>operation<div>b8888operation9999c8888operation9999</div></div>")
		expect($c.fillTemplate("<div>${name}<div>${declare i=0,len=${arr}.length}${while (${i}<${len})}${${arr}[i].hi}8888${name}9999${i++,null}${end while}</div></div>",obj))
				.toBe("<div>operation<div>b8888operation9999c8888operation9999</div></div><div>operation<div>b8888operation9999c8888operation9999</div></div>")
		expect($c.fillTemplate("<div>${script}var a = 0;a += 20;echo('${a} number is: ');echo(a);echo(10);${end script}<div>",obj3)).toBe("<div>monday number is: 2010<div>");
		expect($c.fillTemplate("<div>${try}echo('asdf');var a = null; a.foo;${catch (e)}echo(e);${finally}echo('finallyy')${end try}<div>",obj3)).toBe("<div>asdfError: TypeError: Cannot read property 'foo' of nullfinallyy<div>");
		expect($c.fillTemplate("<div>" +
				"${switch (${hello})}" +
				"${case 'world':}<span>${a}</span>" +
				"${case 'bite':}<p>${b}</p>" +
				"${break}" +
				"${case 'me':}<a>${a}</a>" +
				"${default}<div>${b}</div>" +
				"${end switch}</div>",obj3)).toBe("<div><div>tuesday</div></div>");
		expect($c.fillTemplate("<div>" +
				"${switch (${hello})}" +
				"${case 'world':}<span>${a}</span>" +
				"${case 'bite':}<p>${b}</p>" +
				"${break}" +
				"${case 'me':}<a>${a}</a>" +
				"${default}<div>${b}</div>" +
				"${end switch}</div>",obj4)).toBe("<div><span>monday</span><p>tuesday</p></div>");
		expect($c.fillTemplate("<div>" +
				"${switch (${hello})}" +
				"${case 'world':}<span>${a}</span>" +
				"${case 'bite':}<p>${b}</p>" +
				"${break}" +
				"${case 'me':}<a>${a}</a>" +
				"${default}<div>${b}</div>" +
				"${end switch}</div>",obj5)).toBe("<div><p>tuesday</p></div>");
		expect($c.fillTemplate('${foreach ${item} in ${this.DATA.page}}${if (${true})}<div>${item.name}</div>${end if}${end foreach}',
				{DATA:{page:[{name:'name1'},{name:'name2'}]}})).toBe('<div>name1</div><div>name2</div>');
		expect($c.fillTemplate('${foreach ${item} in ${this.TASK.subtasks}}\
			${if (${item.sub_complete})}\
				True\
			${else}\
				False\
			${end if}\
		${end foreach}',{TASK:{subtasks:[{sub_complete:true}]}}).trim()).toBe('True');
	});
});